{% extends "base.html" %}

{% block title %}Belge Revize Et - {{ file.title }} - Dokumanet{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Header -->
    <div class="mb-8">
        <div class="flex items-center space-x-2 text-sm text-gray-500 mb-4">
            <a href="{{ url_for('department_dashboard') }}" class="hover:text-gray-700">Departman Paneli</a>
            <i class="fas fa-chevron-right"></i>
            <a href="{{ url_for('view_file', file_id=file.id) }}" class="hover:text-gray-700">{{ file.title }}</a>
            <i class="fas fa-chevron-right"></i>
            <span class="text-gray-900">Revizyon Yükle</span>
        </div>
        <h1 class="text-3xl font-bold text-gray-900">Belge Revize Et</h1>
        <p class="text-gray-600">Mevcut belgenin yeni bir versiyonunu yükleyin</p>
    </div>

    <!-- Current File Info -->
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-8">
        <h2 class="text-lg font-semibold text-blue-900 mb-4">
            <i class="fas fa-info-circle mr-2"></i> Mevcut Belge Bilgileri
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
            <div>
                <span class="font-medium text-blue-800">Başlık:</span>
                <span class="text-blue-700 ml-2">{{ file.title }}</span>
            </div>
            <div>
                <span class="font-medium text-blue-800">Versiyon:</span>
                <span class="text-blue-700 ml-2">v{{ file.version_number }}</span>
            </div>
            <div>
                <span class="font-medium text-blue-800">Kategori:</span>
                <span class="text-blue-700 ml-2">{{ file.category or 'Belirtilmemiş' }}</span>
            </div>
            <div>
                <span class="font-medium text-blue-800">Durum:</span>
                {% if file.status == 'pending' %}
                    <span class="ml-2 px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800">
                        Beklemede
                    </span>
                {% elif file.status == 'approved' %}
                    <span class="ml-2 px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">
                        Onaylandı
                    </span>
                {% elif file.status == 'rejected' %}
                    <span class="ml-2 px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800">
                        Reddedildi
                    </span>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Revision Form -->
    <div class="bg-white rounded-lg shadow-sm border p-8">
        <form method="POST" enctype="multipart/form-data" class="space-y-6">
            <!-- Title -->
            <div>
                <label for="title" class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-heading mr-1"></i> Belge Başlığı *
                </label>
                <input type="text" 
                       id="title" 
                       name="title" 
                       required 
                       value="{{ file.title }}"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pk-green focus:border-transparent"
                       placeholder="Belgeniz için açıklayıcı bir başlık girin">
            </div>

            <!-- Description -->
            <div>
                <label for="description" class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-align-left mr-1"></i> Açıklama
                </label>
                <textarea id="description" 
                          name="description" 
                          rows="4"
                          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pk-green focus:border-transparent"
                          placeholder="Belgeniz hakkında detaylı bilgi verin (isteğe bağlı)">{{ file.description or '' }}</textarea>
            </div>

            <!-- Category -->
            <div>
                <label for="category" class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-tag mr-1"></i> Kategori
                </label>
                <select id="category" 
                        name="category" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pk-green focus:border-transparent">
                    <option value="">Kategori seçin</option>
                    <option value="Sözleşme" {% if file.category == 'Sözleşme' %}selected{% endif %}>Sözleşme</option>
                    <option value="Fatura" {% if file.category == 'Fatura' %}selected{% endif %}>Fatura</option>
                    <option value="Rapor" {% if file.category == 'Rapor' %}selected{% endif %}>Rapor</option>
                    <option value="Sunum" {% if file.category == 'Sunum' %}selected{% endif %}>Sunum</option>
                    <option value="Belge" {% if file.category == 'Belge' %}selected{% endif %}>Genel Belge</option>
                    <option value="Resim" {% if file.category == 'Resim' %}selected{% endif %}>Resim/Fotoğraf</option>
                    <option value="Video" {% if file.category == 'Video' %}selected{% endif %}>Video</option>
                    <option value="Diğer" {% if file.category == 'Diğer' %}selected{% endif %}>Diğer</option>
                </select>
            </div>

            <!-- Revision Notes -->
            <div>
                <label for="revision_notes" class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-sticky-note mr-1"></i> Revizyon Notları *
                </label>
                <textarea id="revision_notes" 
                          name="revision_notes" 
                          rows="3"
                          required
                          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pk-green focus:border-transparent"
                          placeholder="Bu revizyonda ne değişti? Hangi güncellemeler yapıldı? (Zorunlu alan)"></textarea>
                <p class="text-xs text-gray-500 mt-1">Bu notlar revizyon geçmişinde görünecektir.</p>
            </div>

            <!-- File Upload -->
            <div>
                <label for="file" class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-cloud-upload-alt mr-1"></i> Yeni Dosya Seç *
                </label>
                <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-pk-green transition-colors">
                    <input type="file" 
                           id="file" 
                           name="file" 
                           required 
                           accept=".pdf,.jpg,.jpeg,.png,.mp4,.docx,.xlsx,.txt"
                           class="hidden"
                           onchange="updateFileName(this)">
                    <label for="file" class="cursor-pointer">
                        <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                        <div class="text-lg font-medium text-gray-900 mb-2">Yeni dosya yüklemek için tıklayın</div>
                        <div class="text-sm text-gray-500" id="file-info">
                            veya dosyayı buraya sürükleyin
                        </div>
                    </label>
                </div>
                
                <!-- File Info -->
                <div class="mt-4 text-sm text-gray-600">
                    <p><strong>Desteklenen formatlar:</strong> PDF, JPG, PNG, MP4, DOCX, XLSX, TXT</p>
                    <p><strong>Maksimum dosya boyutu:</strong> 50 MB</p>
                </div>
            </div>

            <!-- Submit Buttons -->
            <div class="flex justify-between items-center pt-6 border-t">
                <a href="{{ url_for('view_file', file_id=file.id) }}" 
                   class="px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors">
                    <i class="fas fa-arrow-left mr-2"></i> Geri Dön
                </a>
                
                <button type="submit" 
                        class="px-6 py-2 bg-pk-green text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-pk-green transition-colors">
                    <i class="fas fa-code-branch mr-2"></i> Revizyon Yükle
                </button>
            </div>
        </form>
    </div>

    <!-- Help Section -->
    <div class="mt-8 bg-yellow-50 border border-yellow-200 rounded-lg p-6">
        <h3 class="text-lg font-medium text-yellow-900 mb-4">
            <i class="fas fa-lightbulb mr-2"></i> Revizyon Sistemi Hakkında
        </h3>
        <div class="text-sm text-yellow-800 space-y-2">
            <p>• <strong>Yeni versiyon:</strong> Bu işlem belgenizin yeni bir versiyonunu oluşturacak</p>
            <p>• <strong>Önceki versiyonlar:</strong> Eski versiyonlar silinmez, tüm geçmiş korunur</p>
            <p>• <strong>Onay süreci:</strong> Yeni revizyon tekrar onay sürecine girecek</p>
            <p>• <strong>Versiyon numarası:</strong> Otomatik olarak v{{ file.version_number + 1 }} olacak</p>
            <p>• <strong>Revizyon notları:</strong> Değişiklikleri açıklamayı unutmayın</p>
        </div>
    </div>
</div>

<script>
function updateFileName(input) {
    const fileInfo = document.getElementById('file-info');
    if (input.files && input.files[0]) {
        const file = input.files[0];
        const size = (file.size / 1024 / 1024).toFixed(2);
        fileInfo.innerHTML = `
            <div class="text-pk-green font-medium">${file.name}</div>
            <div class="text-gray-500">Boyut: ${size} MB</div>
        `;
    } else {
        fileInfo.innerHTML = 'veya dosyayı buraya sürükleyin';
    }
}

// Drag and drop functionality
const dropZone = document.querySelector('.border-dashed');
const fileInput = document.getElementById('file');

dropZone.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropZone.classList.add('border-pk-green', 'bg-green-50');
});

dropZone.addEventListener('dragleave', (e) => {
    e.preventDefault();
    dropZone.classList.remove('border-pk-green', 'bg-green-50');
});

dropZone.addEventListener('drop', (e) => {
    e.preventDefault();
    dropZone.classList.remove('border-pk-green', 'bg-green-50');
    
    const files = e.dataTransfer.files;
    if (files.length > 0) {
        fileInput.files = files;
        updateFileName(fileInput);
    }
});
</script>
{% endblock %}
